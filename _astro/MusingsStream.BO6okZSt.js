import{o as je,a as Pe,i as Te,b as L,s as Ce,c as Ne,d as Oe,e as De}from"./router.w6Jd3Pfz.js";import{C as Fe,D as de,E as ve,F as He,G as Ue,h as te,I as $e,J as qe,L as Be,N as Re,K as We,M as Ge,y as Je,O as b,P as Ke,Q as x,B as Ve,R as u,S as j,T as t,U as D,V as g,W as w,X as q,Y as oe,Z as X,_ as z,$ as F}from"./template.CUcBOH1Q.js";import{s as K}from"./render.DWYK8PyM.js";import{e as Ye,h as Ze}from"./ContentPane.BiVhIgo6.js";import Qe from"./index.Blr6EMNg.js";import{H as Xe}from"./core.BG_Koye0.js";import ze from"./cpp.Bm3ii6kY.js";function le(a,n,d){Fe(()=>{var p=de(()=>n(a,d?.())||{});if(d&&p?.update){var o=!1,f={};ve(()=>{var E=d();He(E),o&&Ue(f,E)&&(f=E,p.update(E))}),o=!0}if(p?.destroy)return()=>p.destroy()})}const Ie=Symbol("is custom element"),et=Symbol("is html");function tt(a){if(te){var n=!1,d=()=>{if(!n){if(n=!0,a.hasAttribute("value")){var p=a.value;ce(a,"value",null),a.value=p}if(a.hasAttribute("checked")){var o=a.checked;ce(a,"checked",null),a.checked=o}}};a.__on_r=d,$e(d),qe()}}function ce(a,n,d,p){var o=rt(a);te&&(o[n]=a.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&a.nodeName==="LINK")||o[n]!==(o[n]=d)&&(n==="loading"&&(a[Be]=d),a.removeAttribute(n))}function rt(a){return a.__attributes??={[Ie]:a.nodeName.includes("-"),[et]:a.namespaceURI===Re}}function at(a,n,d=n){var p=We();Ge(a,"input",o=>{var f=o?a.defaultValue:a.value;if(f=I(a)?ee(f):f,d(f),p&&f!==(f=n())){var E=a.selectionStart,k=a.selectionEnd;a.value=f??"",k!==null&&(a.selectionStart=E,a.selectionEnd=Math.min(k,a.value.length))}}),(te&&a.defaultValue!==a.value||de(n)==null&&a.value)&&d(I(a)?ee(a.value):a.value),ve(()=>{var o=n();I(a)&&o===ee(a.value)||a.type==="date"&&!o&&!a.value||o!==a.value&&(a.value=o??"")})}function I(a){var n=a.type;return n==="number"||n==="range"}function ee(a){return a===""?null:+a}var st=b('<div class="text-text-muted text-sm">Your connection is rather slow, peasant...</div>'),it=b('<div class="text-text-muted text-sm">No musings found.</div>'),nt=b('<div class="rounded-sm border border-text-muted p-3 mb-4 bg-[color:var(--el-surface)]"><div class="flex items-center gap-2"><input type="password" class="px-2 py-1 rounded-sm bg-[color:var(--el-surface)] border border-text-muted text-xs flex-1 text-text placeholder:text-text transition-colors" placeholder="Key" id="global-passphrase"/> <button class="px-2 py-1 text-xs border border-accent-subtle rounded hover:bg-accent-subtle/20 disabled:opacity-50 text-text hover:text-accent transition-colors">Clear</button></div></div>'),ot=b('<button class="text-xs text-accent hover:text-accent/80 disabled:opacity-50"> </button>'),lt=b('<div class="break-all"> </div>'),ct=b('<div class="text-xs text-text-muted">Loading preview…</div>'),dt=b('<div class="text-xs text-accent mt-1"> </div>'),vt=b('<div class="mt-1"><!> <!></div>'),ut=b('<div class="mt-1"><article><!></article></div>'),ft=b('<div class="mt-1 text-xs text-text-muted">Loading…</div>'),mt=b('<li class="rounded-sm border border-text-muted bg-[color:var(--el-surface)] p-3"><div class="flex items-center justify-between gap-2"><div class="text-xs text-text-muted"> </div> <!></div> <!></li>'),_t=b('<div class="h-10"></div>'),ht=b('<!> <!> <ul class="list-none p-0 m-0 space-y-6"></ul> <!>',1);function St(a,n){Je(n,!1);const[d,p]=Ce(),o=()=>Oe(De,"$currentSkin",d),f=Xe;f.registerLanguage("cpp",ze);const E=new Qe({html:!0,linkify:!0,highlight:(e,r)=>{const s=(r||"").toLowerCase();if(["cpp","c++","cc","cxx","hpp","hxx"].includes(s))try{return`<pre class="hljs"><code>${f.highlight(e,{language:"cpp"}).value}</code></pre>`}catch{}return`<pre class="hljs"><code>${E.utils.escapeHtml(e)}</code></pre>`}});let k=j([]),R=j(!1),S=j({}),m=j({}),P=j(new Set),_=j({}),H=j(""),U=null;function ue(){return U||(U=new Worker(new URL("/_astro/musingsWorker-CyUrPyvB.js",import.meta.url),{type:"module"})),U}let T=j({});const W={};function fe(e){const r=e.split("");for(let s=r.length-1;s>0;s--){const i=Math.floor(Math.random()*(s+1));[r[s],r[i]]=[r[i],r[s]]}return r.join("")}function me(e){const r="decrypt";F(T,t(T)[e]=r),W[e]=window.setInterval(()=>{F(T,t(T)[e]=fe(r)),u(T,{...t(T)})},80)}function _e(e){W[e]&&(window.clearInterval(W[e]),delete W[e],delete t(T)[e])}function he(e){return new Date(e).toLocaleString()}function re(){if(typeof window<"u"){const e=window.MathJax;e?.typesetPromise&&e.typesetPromise()}}const ae=12;let G=j(ae);function xe(e,r){const s=new IntersectionObserver(i=>{for(const l of i)if(l.isIntersecting){try{r?.()}catch{}s.unobserve(e)}},{rootMargin:"400px 0px"});return s.observe(e),{destroy(){s.disconnect()}}}function be(e,r){let s=!1;const i=new IntersectionObserver(l=>{for(const A of l)if(A.isIntersecting&&!s){s=!0,i.unobserve(e);try{r?.()}finally{requestAnimationFrame(()=>{setTimeout(()=>{s=!1,i.observe(e)},50)})}}},{rootMargin:"200px 0px"});return i.observe(e),{destroy(){i.disconnect()}}}function ge(e){e.tier==="public"?t(m)[e.id]||V(e).then(async r=>{const s=r;s&&s.md&&(F(m,t(m)[e.id]={md:s.md}),u(m,{...t(m)}),await z(),re())}):t(S)[e.id]||V(e)}async function V(e){if(t(S)[e.id])return t(S)[e.id];try{const r=await fetch(`/musings/${e.path}`);if(!r.ok)return null;const s=await r.json();return F(S,t(S)[e.id]=s),u(S,{...t(S)}),s}catch{return null}}async function pe(e,r){if(r.trim()){t(P).add(e),u(P,new Set(t(P))),delete t(_)[e],u(_,{...t(_)}),me(e),await z();try{const s=t(k).find(l=>l.id===e);if(!s||s.tier==="public")return;const i=await V(s);if(!i)throw new Error("Failed to load blob");await new Promise(l=>{const A=ue(),J=Z=>{const C=Z.data;!C||C.id!==e||(A.removeEventListener("message",J),C.ok?(F(m,t(m)[e]={md:C.md}),u(m,{...t(m)})):(F(_,t(_)[e]=C.error||"Failed to decrypt"),u(_,{...t(_)})),l())};A.addEventListener("message",J),A.postMessage({id:e,blob:i,pass:r})}),await z(),re()}catch(s){F(_,t(_)[e]=s?.message??String(s)),u(_,{...t(_)})}finally{t(P).delete(e),u(P,new Set(t(P))),_e(e)}}}je(async()=>{try{const e=await fetch("/musings/manifest.json");e.ok&&(u(k,await e.json()),u(R,!0))}catch(e){console.error("Failed to load musings manifest:",e)}}),Pe(()=>{U&&(U.terminate(),U=null)}),Te();var se=ht(),ie=Ke(se);{var ye=e=>{var r=st();x(e,r)},we=(e,r)=>{{var s=i=>{var l=it();x(i,l)};L(e,i=>{t(k).length===0&&i(s)},r)}};L(ie,e=>{t(R)?e(we,!1):e(ye)})}var ne=D(ie,2);{var ke=e=>{var r=nt(),s=w(r),i=w(s);tt(i);var l=D(i,2);g(s),g(r),q(()=>l.disabled=!t(H)),at(i,()=>t(H),A=>u(H,A)),oe("click",l,()=>u(H,"")),x(e,r)};L(ne,e=>{t(R)&&t(k).length>0&&e(ke)})}var Y=D(ne,2);Ye(Y,5,()=>t(k).slice(0,t(G)),e=>e.id,(e,r)=>{var s=mt(),i=w(s),l=w(i),A=w(l,!0);g(l);var J=D(l,2);{var Z=v=>{var h=ot(),$=w(h,!0);g(h),q((B,M)=>{h.disabled=B,K($,M)},[()=>t(P).has(t(r).id)||!t(H).trim(),()=>t(P).has(t(r).id)?t(T)[t(r).id]||"decrypting...":"decrypt"],X),oe("click",h,()=>pe(t(r).id,t(H))),x(v,h)};L(J,v=>{t(r).tier!=="public"&&!t(m)[t(r).id]&&v(Z)})}g(i);var C=D(i,2);{var Le=v=>{var h=vt(),$=w(h);{var B=c=>{var y=lt(),Q=w(y);g(y),q(Ae=>K(Q,`${Ae??""}${t(S)[t(r).id].ct.length>160?"…":""}`),[()=>t(S)[t(r).id].ct.slice(0,160)],X),x(c,y)},M=c=>{var y=ct();x(c,y)};L($,c=>{t(S)[t(r).id]?c(B):c(M,!1)})}var N=D($,2);{var O=c=>{var y=dt(),Q=w(y,!0);g(y),q(()=>K(Q,t(_)[t(r).id])),x(c,y)};L(N,c=>{t(_)[t(r).id]&&c(O)})}g(h),x(v,h)},Ee=(v,h)=>{{var $=M=>{var N=ut(),O=w(N),c=w(O);Ze(c,()=>E.render(t(m)[t(r).id].md)),g(O),g(N),q(()=>Ne(O,1,`${o().classes.contentPane??""} max-w-none`)),x(M,N)},B=(M,N)=>{{var O=c=>{var y=ft();x(c,y)};L(M,c=>{t(r).tier==="public"&&c(O)},N)}};L(v,M=>{t(m)[t(r).id]?M($):M(B,!1)},h)}};L(C,v=>{t(r).tier!=="public"&&!t(m)[t(r).id]?v(Le):v(Ee,!1)})}g(s),le(s,(v,h)=>xe?.(v,h),()=>()=>ge(t(r))),q(v=>K(A,v),[()=>he(t(r).ts)],X),x(e,s)}),g(Y);var Se=D(Y,2);{var Me=e=>{var r=_t();le(r,(s,i)=>be?.(s,i),()=>()=>u(G,Math.min(t(k).length,t(G)+ae))),x(e,r)};L(Se,e=>{t(R)&&t(G)<t(k).length&&e(Me)})}x(a,se),Ve(),p()}export{St as default};

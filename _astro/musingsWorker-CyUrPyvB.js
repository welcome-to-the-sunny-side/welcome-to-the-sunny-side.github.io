(function(){"use strict";function Y(U){return U&&U.__esModule&&Object.prototype.hasOwnProperty.call(U,"default")?U.default:U}var Z={exports:{}},B;function N(){return B||(B=1,function(U,L){(function(w){function v(f){const e=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);let t=1779033703,o=3144134277,r=1013904242,c=2773480762,n=1359893119,a=2600822924,h=528734635,u=1541459225;const A=new Uint32Array(64);function y(_){let V=0,m=_.length;for(;m>=64;){let x=t,j=o,O=r,P=c,s=n,E=a,l=h,$=u,p,b,k,q,J;for(b=0;b<16;b++)k=V+b*4,A[b]=(_[k]&255)<<24|(_[k+1]&255)<<16|(_[k+2]&255)<<8|_[k+3]&255;for(b=16;b<64;b++)p=A[b-2],q=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,p=A[b-15],J=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,A[b]=(q+A[b-7]|0)+(J+A[b-16]|0)|0;for(b=0;b<64;b++)q=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&E^~s&l)|0)+($+(e[b]+A[b]|0)|0)|0,J=((x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10))+(x&j^x&O^j&O)|0,$=l,l=E,E=s,s=P+q|0,P=O,O=j,j=x,x=q+J|0;t=t+x|0,o=o+j|0,r=r+O|0,c=c+P|0,n=n+s|0,a=a+E|0,h=h+l|0,u=u+$|0,V+=64,m-=64}}y(f);let I,D=f.length%64,S=f.length/536870912|0,g=f.length<<3,H=D<56?56:120,d=f.slice(f.length-D,f.length);for(d.push(128),I=D+1;I<H;I++)d.push(0);return d.push(S>>>24&255),d.push(S>>>16&255),d.push(S>>>8&255),d.push(S>>>0&255),d.push(g>>>24&255),d.push(g>>>16&255),d.push(g>>>8&255),d.push(g>>>0&255),y(d),[t>>>24&255,t>>>16&255,t>>>8&255,t>>>0&255,o>>>24&255,o>>>16&255,o>>>8&255,o>>>0&255,r>>>24&255,r>>>16&255,r>>>8&255,r>>>0&255,c>>>24&255,c>>>16&255,c>>>8&255,c>>>0&255,n>>>24&255,n>>>16&255,n>>>8&255,n>>>0&255,a>>>24&255,a>>>16&255,a>>>8&255,a>>>0&255,h>>>24&255,h>>>16&255,h>>>8&255,h>>>0&255,u>>>24&255,u>>>16&255,u>>>8&255,u>>>0&255]}function F(f,e,t){f=f.length<=64?f:v(f);const o=64+e.length+4,r=new Array(o),c=new Array(64);let n,a=[];for(n=0;n<64;n++)r[n]=54;for(n=0;n<f.length;n++)r[n]^=f[n];for(n=0;n<e.length;n++)r[64+n]=e[n];for(n=o-4;n<o;n++)r[n]=0;for(n=0;n<64;n++)c[n]=92;for(n=0;n<f.length;n++)c[n]^=f[n];function h(){for(let u=o-1;u>=o-4;u--){if(r[u]++,r[u]<=255)return;r[u]=0}}for(;t>=32;)h(),a=a.concat(v(c.concat(v(r)))),t-=32;return t>0&&(h(),a=a.concat(v(c.concat(v(r))).slice(0,t))),a}function G(f,e,t,o,r){let c;for(M(f,(2*t-1)*16,r,0,16),c=0;c<2*t;c++)R(f,c*16,r,16),Q(r,o),M(r,0,f,e+c*16,16);for(c=0;c<t;c++)M(f,e+c*2*16,f,c*16,16);for(c=0;c<t;c++)M(f,e+(c*2+1)*16,f,(c+t)*16,16)}function i(f,e){return f<<e|f>>>32-e}function Q(f,e){M(f,0,e,0,16);for(let t=8;t>0;t-=2)e[4]^=i(e[0]+e[12],7),e[8]^=i(e[4]+e[0],9),e[12]^=i(e[8]+e[4],13),e[0]^=i(e[12]+e[8],18),e[9]^=i(e[5]+e[1],7),e[13]^=i(e[9]+e[5],9),e[1]^=i(e[13]+e[9],13),e[5]^=i(e[1]+e[13],18),e[14]^=i(e[10]+e[6],7),e[2]^=i(e[14]+e[10],9),e[6]^=i(e[2]+e[14],13),e[10]^=i(e[6]+e[2],18),e[3]^=i(e[15]+e[11],7),e[7]^=i(e[3]+e[15],9),e[11]^=i(e[7]+e[3],13),e[15]^=i(e[11]+e[7],18),e[1]^=i(e[0]+e[3],7),e[2]^=i(e[1]+e[0],9),e[3]^=i(e[2]+e[1],13),e[0]^=i(e[3]+e[2],18),e[6]^=i(e[5]+e[4],7),e[7]^=i(e[6]+e[5],9),e[4]^=i(e[7]+e[6],13),e[5]^=i(e[4]+e[7],18),e[11]^=i(e[10]+e[9],7),e[8]^=i(e[11]+e[10],9),e[9]^=i(e[8]+e[11],13),e[10]^=i(e[9]+e[8],18),e[12]^=i(e[15]+e[14],7),e[13]^=i(e[12]+e[15],9),e[14]^=i(e[13]+e[12],13),e[15]^=i(e[14]+e[13],18);for(let t=0;t<16;++t)f[t]+=e[t]}function R(f,e,t,o){for(let r=0;r<o;r++)t[r]^=f[e+r]}function M(f,e,t,o,r){for(;r--;)t[o++]=f[e++]}function X(f){if(!f||typeof f.length!="number")return!1;for(let e=0;e<f.length;e++){const t=f[e];if(typeof t!="number"||t%1||t<0||t>=256)return!1}return!0}function T(f,e){if(typeof f!="number"||f%1)throw new Error("invalid "+e);return f}function C(f,e,t,o,r,c,n){if(t=T(t,"N"),o=T(o,"r"),r=T(r,"p"),c=T(c,"dkLen"),t===0||(t&t-1)!==0)throw new Error("N must be power of 2");if(t>2147483647/128/o)throw new Error("N too large");if(o>2147483647/128/r)throw new Error("r too large");if(!X(f))throw new Error("password must be an array or buffer");if(f=Array.prototype.slice.call(f),!X(e))throw new Error("salt must be an array or buffer");e=Array.prototype.slice.call(e);let a=F(f,e,r*128*o);const h=new Uint32Array(r*32*o);for(let s=0;s<h.length;s++){const E=s*4;h[s]=(a[E+3]&255)<<24|(a[E+2]&255)<<16|(a[E+1]&255)<<8|(a[E+0]&255)<<0}const u=new Uint32Array(64*o),A=new Uint32Array(32*o*t),y=32*o,I=new Uint32Array(16),D=new Uint32Array(16),S=r*t*2;let g=0,H=null,d=!1,_=0,V=0,m,x;const j=n?parseInt(1e3/o):4294967295,O=typeof setImmediate<"u"?setImmediate:setTimeout,P=function(){if(d)return n(new Error("cancelled"),g/S);let s;switch(_){case 0:x=V*32*o,M(h,x,u,0,y),_=1,m=0;case 1:s=t-m,s>j&&(s=j);for(let l=0;l<s;l++)M(u,0,A,(m+l)*y,y),G(u,y,o,I,D);if(m+=s,g+=s,n){const l=parseInt(1e3*g/S);if(l!==H){if(d=n(null,g/S),d)break;H=l}}if(m<t)break;m=0,_=2;case 2:s=t-m,s>j&&(s=j);for(let l=0;l<s;l++){const $=(2*o-1)*16,p=u[$]&t-1;R(A,p*y,u,y),G(u,y,o,I,D)}if(m+=s,g+=s,n){const l=parseInt(1e3*g/S);if(l!==H){if(d=n(null,g/S),d)break;H=l}}if(m<t)break;if(M(u,0,h,x,y),V++,V<r){_=0;break}a=[];for(let l=0;l<h.length;l++)a.push(h[l]>>0&255),a.push(h[l]>>8&255),a.push(h[l]>>16&255),a.push(h[l]>>24&255);const E=F(f,a,c);return n&&n(null,1,E),E}n&&O(P)};if(!n)for(;;){const s=P();if(s!=null)return s}P()}const W={scrypt:function(f,e,t,o,r,c,n){return new Promise(function(a,h){let u=0;n&&n(0),C(f,e,t,o,r,c,function(A,y,I){if(A)h(A);else if(I)n&&u!==1&&n(1),a(new Uint8Array(I));else if(n&&y!==u)return u=y,n(y)})})},syncScrypt:function(f,e,t,o,r,c){return new Uint8Array(C(f,e,t,o,r,c))}};U.exports=W})()}(Z)),Z.exports}var e0=N(),f0=Y(e0);const{scrypt:t0}=f0;function z(U){const L=atob(U),w=new Uint8Array(L.length);for(let K=0;K<L.length;K++)w[K]=L.charCodeAt(K);return w}self.onmessage=async U=>{const{id:L,blob:w,pass:K}=U.data;try{if(!K)throw new Error("Empty passphrase");const v=new TextEncoder,F=v.encode(K),G=z(w.kdf.salt),Q=await t0(F,G,w.kdf.N,w.kdf.r,w.kdf.p,32,e=>{}),R=await crypto.subtle.importKey("raw",Q,{name:"AES-GCM"},!1,["decrypt"]),M=z(w.iv),X=z(w.ct),T=v.encode(w.ad??`musings:${w.id}:v${w.v??1}`),C=await crypto.subtle.decrypt({name:"AES-GCM",iv:M,additionalData:T},R,X),W=new TextDecoder().decode(C),f=JSON.parse(W);self.postMessage({id:L,ok:!0,md:f.md})}catch(v){self.postMessage({id:L,ok:!1,error:v?.message??String(v)})}}})();
